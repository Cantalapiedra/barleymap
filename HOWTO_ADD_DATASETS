HOWTO_ADD_DATASETS is part of Barleymap.
Copyright (C)  2013-2014  Carlos P Cantalapiedra.
(terms of use can be found within the distributed LICENSE file).

# Carlos P Cantalapiedra 20131227 (updated 20140318)
# HOWTO_ADD_DATASETS in Barleymap standalone application

# 1) Create a directory with DATASET_ID under datasets/ directory

# Example:
datasets/newdataset

# 2) Add the query-target data for each database into the previous directory

# The query-target file must have 9 tab-separated fields.
#
# query: the sequence to search.
# target: the sequence hit by the alignment.
# alignment_identity_%: percentage of identity when comparing query and target. Used to filter results.
# query_coverage_%: percentage of query bases that are part of the alignment. Used to filter results.
# alignment_score: a measurement of the certainty of the alignment. Used to filter results (--best-score parameter).
# strand: relative orientation of query on target. Just used as additional information.
# starting_position_in_target: local position on target, where the alignment starts.
# database: information about the origin of the target.
# algorithm: just information about the origin of the alignment (blastn, gmap, ...).

# An easy way to create the query-target file is by means of bmaux_align_fasta
# command, with a different run for each database or in one run, and then
# separating the output data corresponding to each database.
#
# NOTE that the name of the file must follow the following pattern with ".hits" extension:

DATASET_ID.DATABASE_ID.hits

# where DATASET_ID is the name specified in step 1)
# and DATABASE_ID the one used in HOWTO_ADD_DATABASES

# Examples of directories and files for 2 databases and 2 datasets:
datasets/newdataset/newdataset.newdb.hits
datasets/newdataset/newdataset.anotherdb.hits
datasets/anotherdataset/anotherdataset.newdb.hits
datasets/anotherdataset/anotherdataset.anotherdb.hits

# Example of generation of one file with bmaux_align_fasta command:

cd bin/;
./bmaux_align_fasta --align-info=yes --best-score=no --databases=MorexWGS --query-mode=auto \
--thres-id=98 --thres-cov=95 --threads=2 --hierarchical=no \
NEWDATASET.FASTA > ../datasets/newdataset/newdataset.morex_ass.hits;

# 2.1) In addition to the DATASET_ID.DATABASE_ID.hits files for each database, Barleymap will detect
#      if a file DATASET_ID.genes.hits is available for each dataset. Such file, with tab separated
#      marker-gene pairs, will be used to output "genes" field in marker's information in the map enriched
#      with markers. This "genes.hits" files can be easily generated by means of "bmaux_align_external" script
#      using the FASTA of markers as query, and creating a database of genes FASTA sequences to align to.

# Example of file for newdataset:

datasets/newdataset/newdataset.genes.hits;

# Example of generation of one file with bmaux_align_external command, to obtain hits to two genes databases:

#(inside configured blast databases folder):
makeblastdb --dbtype nucl genes_HC.fasta
makeblastdb --dbtype nucl genes_LC.fasta

#(inside configured gmap databases folder):
gmap-build -d genes_HC genes_HC.fasta
gmap-build -d genes_LC genes_LC.fasta

cd /barleymapfolder/bin/;
bmaux_align_external --databases=genes_HC,genes_LC --query-mode=auto --threads=2 --hierarchical=yes \
--best-score=yes NEWDATASET.FASTA > ../datasets/newdataset/newdataset.genes.hits;

# 3) Add a line in conf/datasets.conf, with three fields blank space separated, where
#       the first field is the name that will be shown for that dataset,
#       the second field is the DATASET_ID used in step 1)
#       and the third field has to be "genetic_marker" if markers from this dataset
#           must be shown in the map enriched with markers. Otherwise, a different value,
#           for example "no_enrich", "no_located", "mRNA", ... can be used as third field.

#       Example:

My_New_Dataset newdataset genetic_marker
RNAContigs rna_contigs_assembly mRNA

# 4) If correctly configured, the new datasets should be listed under "DATASETS" section in "Configured data"
# when running bmaux_check_config auxiliar script.

##
